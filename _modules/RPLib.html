<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>RPLib &mdash; RPLib 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="RPLib 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">RPLib 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for RPLib</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">arcpy</span><span class="o">,</span> <span class="nn">smtplib</span><span class="o">,</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">httplib</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">arcpy</span> <span class="kn">import</span> <span class="n">env</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="c"># pylint: disable-msg=C0103</span>
<span class="c"># pylint: disable-msg=C0303</span>
<span class="c">## email method variables</span>
<span class="n">email_ON</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">email_To</span> <span class="o">=</span> <span class="p">()</span>
<span class="n">email_From</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">email_Subject</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">email_Msg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">email_IP</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">email_Port</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">email_Username</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">email_Password</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

<span class="c">## Logging variables</span>
<span class="n">verboseLog</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c">## recPost method variables</span>
<span class="n">recpost_Log</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

<span class="c">## createVersions method variables</span>
<span class="n">createVersions_List</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">Logger</span><span class="p">(</span><span class="n">Log_Loc</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,):</span>

    <span class="n">DATE</span> <span class="o">=</span> <span class="s">&#39;%Y_%m_</span><span class="si">%d</span><span class="s">&#39;</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="s">&#39;%H_%M%p&#39;</span>
    <span class="n">Script_Log</span> <span class="o">=</span> <span class="n">Log_Loc</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Script_Log</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">Script_Log</span><span class="p">):</span>
            <span class="n">ScriptLog</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;{0}//ScriptLog&quot;</span>
                        <span class="s">&quot;_{1}_{2}.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Script_Log</span><span class="p">,</span>
                                              <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">DATE</span><span class="p">),</span>
                                              <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">TIME</span><span class="p">)))</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">ScriptLog</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">Tee</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;The specified path for storing the log file does not&quot;</span>
                  <span class="s">&quot; exist!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;A path for the log file location must be specified!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tee</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">files</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">files</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

<div class="viewcode-block" id="clearworkspacecache"><a class="viewcode-back" href="../clearworkspacecache.html#RPLib.clearworkspacecache">[docs]</a><span class="k">def</span> <span class="nf">clearworkspacecache</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Clears any ArcSDE workspaces from the ArcSDE workspace cache.**</span>

<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    Parameter            Type      Description                                                                              Required</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    **Workspace**        String    Path to sde connection file.                                                             Yes</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Clear Workspace Cache&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Clear Workspace Cache&quot;</span><span class="p">):</span>
                <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Clearing workspace cache &quot;</span>
                     <span class="s">&quot;for : {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">ClearWorkspaceCache_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Clear workspace cache&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="s">&quot; Error clearing workspace cache for {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>


</div>
<div class="viewcode-block" id="pauseconnections"><a class="viewcode-back" href="../pauseconnections.html#RPLib.pauseconnections">[docs]</a><span class="k">def</span> <span class="nf">pauseconnections</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Allows an administrator to disable the ability of nonadministrative users to make connections to an enterprise geodatabase.**</span>

<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    Parameter            Type      Description                                                                              Required</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    **Workspace**        String    Path to sde connection file.                                                             Yes</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Process: block new connections to the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Pause Connections&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Pause Connections&quot;</span><span class="p">):</span>
                <span class="n">prnt</span><span class="p">(</span> <span class="s">&quot;Blocking new connections &quot;</span>
                      <span class="s">&quot;for : {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">AcceptConnections</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot;ERROR: Pause connections&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&quot; An error occurred while trying to pause connections for {0}.</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="s">&quot; Please ensure the connection file provided has the required&quot;</span>
        <span class="s">&quot; permissions to pause database connections.</span><span class="se">\n</span><span class="s"> Typically the sde&quot;</span>
        <span class="s">&quot; user handles connections to the database.</span><span class="se">\n</span><span class="s"> If you were not&quot;</span>
        <span class="s">&quot; using a connection file that uses the sde username and password&quot;</span>
        <span class="s">&quot; please try using a connection file which does.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="resumeconnections"><a class="viewcode-back" href="../resumeconnections.html#RPLib.resumeconnections">[docs]</a><span class="k">def</span> <span class="nf">resumeconnections</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Allows an administrator to enable the ability of nonadministrative users to make connections to an enterprise geodatabase.**</span>

<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    Parameter            Type      Description                                                                              Required</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    **Workspace**        String    Path to sde connection file.                                                              Yes</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Process: allow new connections to the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Resume Connections&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Resume Connections&quot;</span><span class="p">):</span>
                <span class="n">prnt</span><span class="p">(</span> <span class="s">&quot;Allowing new connections &quot;</span>
                      <span class="s">&quot;for : {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">AcceptConnections</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot;ERROR: Resume connections&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; An error occurred while trying to resume connections&quot;</span>
              <span class="s">&quot; for {0}.</span><span class="se">\n</span><span class="s"> Please ensure the connection file provided&quot;</span>
              <span class="s">&quot; has the required permissions to resume database connections.</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot; Typically the sde user handles connections to the database.</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot; If you were not using a connection file that uses the sde&quot;</span>
              <span class="s">&quot; username and password please try using a connection file&quot;</span>
              <span class="s">&quot; which does.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="killconnections"><a class="viewcode-back" href="../killconnections.html#RPLib.killconnections">[docs]</a><span class="k">def</span> <span class="nf">killconnections</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Allows an administrator to disconnect all users who are currently connected to an Enterprise geodatabase.**</span>

<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    Parameter            Type      Description                                                                              Required</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    **Workspace**        String    Path to sde connection file                                                              Yes</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Process: disconnect all users from the database.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Kill Connections&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Kill Connections&quot;</span><span class="p">):</span>
                <span class="n">prnt</span><span class="p">(</span> <span class="s">&quot;Killing all connections &quot;</span>
                      <span class="s">&quot;for : {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">DisconnectUser</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span> <span class="s">&quot;ALL&quot;</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Kill connections&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error trying to kill connections for {0}.</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot; Please ensure the connection file provided has the required&quot;</span>
              <span class="s">&quot; permissions to kill database connections.</span><span class="se">\n</span><span class="s"> Typically the&quot;</span>
              <span class="s">&quot; sde user handles connections to the database.</span><span class="se">\n</span><span class="s"> If you were&quot;</span>
              <span class="s">&quot; not using a connection file that uses the sde username and&quot;</span>
              <span class="s">&quot; password please try using a connection file which does.&quot;</span>
              <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="compressgdb"><a class="viewcode-back" href="../compressgdb.html#RPLib.compressgdb">[docs]</a><span class="k">def</span> <span class="nf">compressgdb</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Compresses an enterprise geodatabase by removing states not referenced by a version and redundant rows.**</span>

<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    Parameter            Type      Description                                                                              Required</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    **Workspace**        String    Path to sde connection file.                                                             Yes</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Compress Database&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Compress Database&quot;</span><span class="p">):</span>
                <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Compressing geodatabase: {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">Compress_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Compressing geodatabase&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="s">&quot; Error compressing geodatabase {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="createversions"><a class="viewcode-back" href="../createversions.html#RPLib.createversions">[docs]</a><span class="k">def</span> <span class="nf">createversions</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">Versions_List</span> <span class="o">=</span> <span class="p">[],</span>
                   <span class="n">PublicAccess</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                   <span class="n">ParentVerion</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Creates a new version(s) in the specified geodatabase.**</span>

<span class="sd">    ==================   ========  =======================================================================================  ==========</span>
<span class="sd">    Parameter              Type                                      Description                                             Required</span>
<span class="sd">    ==================   ========  =======================================================================================  ==========</span>
<span class="sd">    **Workspace**        String    Path to sde connection file .                                                            Yes</span>
<span class="sd">    **Versions_List**    List      The name of the version(s) to be created.                                                Yes</span>
<span class="sd">    **PublicAccess**     Boolean   The permission access level for the version.                                             No\n</span>
<span class="sd">                                   * True = Public **(Default)**\n</span>
<span class="sd">                                   * False = Private\n</span>
<span class="sd">                                   * &quot;PROTECTED&quot; = Protected</span>
<span class="sd">    **ParentVersion**    String    The geodatabase, or version of a geodatabase, on which the new version will be based.    No\n</span>
<span class="sd">                                   * None = &quot;sde.default&quot;\n</span>
<span class="sd">                                   * &quot;&quot; = &quot;sde.default&quot;\n</span>
<span class="sd">    ==================   ========  =======================================================================================  ==========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Create Versions&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Create Versions&quot;</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Versions_List</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Create versions&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Invalid expression supplied for parameter&quot;</span>
               <span class="s">&quot; Versions_List !</span><span class="se">\n</span><span class="s"> The parameter cannot be an empty&quot;</span>
               <span class="s">&quot; list.</span><span class="se">\n</span><span class="s"> Expected: List.</span><span class="se">\n</span><span class="s"> Please provide a list&quot;</span>
               <span class="s">&quot; of version name(s) to be created.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">version_name</span> <span class="o">=</span> <span class="n">Versions_List</span>

    <span class="k">if</span> <span class="n">PublicAccess</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">access_permission</span> <span class="o">=</span> <span class="s">&quot;PUBLIC&quot;</span>
    <span class="k">elif</span> <span class="n">PublicAccess</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">access_permission</span> <span class="o">=</span> <span class="s">&quot;PRIVATE&quot;</span>
    <span class="k">elif</span> <span class="n">PublicAccess</span> <span class="o">==</span> <span class="s">&quot;PROTECTED&quot;</span><span class="p">:</span>
        <span class="n">access_permission</span> <span class="o">=</span> <span class="s">&quot;PROTECTED&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Create versions&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter PublicAccess !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True, False, or &quot;PROTECTED&quot; .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PublicAccess</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">parent_version</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">check_parent</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">verList</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">ParentVerion</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ParentVerion</span><span class="p">)</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">parent_version</span> <span class="o">=</span> <span class="s">&quot;sde.default&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">check_parent</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ParentVerion</span><span class="p">)</span>
        <span class="n">check_parent</span> <span class="o">=</span> <span class="n">check_parent</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">ListVersions</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">ver</span><span class="o">.</span><span class="n">isOwner</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">ver</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">check_parent</span><span class="p">:</span>
            <span class="n">parent_version</span> <span class="o">=</span> <span class="n">ParentVerion</span>

    <span class="n">verList</span> <span class="o">=</span> <span class="p">[</span><span class="n">ver</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">ListVersions</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ver</span><span class="o">.</span><span class="n">isOwner</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span>
       <span class="n">ver</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">parent_version</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

    <span class="c"># convert Lists to strings for comparison</span>
    <span class="n">strverList</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">verList</span><span class="p">)</span>

    <span class="n">newversions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">existingversions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">version_name</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="ow">in</span> <span class="n">strverList</span><span class="p">:</span>
            <span class="n">newversions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">existingversions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">existingversions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Create versions&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Unable to create verion(s) {0}, already&quot;</span>
               <span class="s">&quot; exist!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">existingversions</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">newversions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">newversions</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">prnt</span><span class="p">(</span> <span class="s">&quot;Creating version : {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">CreateVersion_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                               <span class="n">parent_version</span><span class="p">,</span>
                                               <span class="n">version</span><span class="p">,</span>
                                               <span class="n">access_permission</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">failed</span><span class="p">()</span>
                <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; Error: Create versions&quot;</span>
                <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; An error occurred while trying to create&quot;</span>
                       <span class="s">&quot; versions for {0}.</span><span class="se">\n</span><span class="s"> Please ensure the correct&quot;</span>
                       <span class="s">&quot; connection file is being referenced and that&quot;</span>
                       <span class="s">&quot; the user has permissions to create versions.</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot; Does the parent version being referenced&quot;</span>
                       <span class="s">&quot; exist?</span><span class="se">\n</span><span class="s"> Is the correct string being passed&quot;</span>
                       <span class="s">&quot; for PublicAccess?</span><span class="se">\n</span><span class="s"> Please review the log file&quot;</span>
                       <span class="s">&quot; for more detailed&quot;</span>
                       <span class="s">&quot; information.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>

                <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Create versions&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; No new versions were created.</span><span class="se">\n</span><span class="s"> All versions&quot;</span>
               <span class="s">&quot; specified: {0} already exist! </span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version_name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="rebuild_indexes_analyze"><a class="viewcode-back" href="../rebuild_indexes_analyze.html#RPLib.rebuild_indexes_analyze">[docs]</a><span class="k">def</span> <span class="nf">rebuild_indexes_analyze</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="n">excludeList</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="n">include_system</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                            <span class="n">delta_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="n">only_versioned</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="n">analyze_base</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="n">analyze_delta</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="n">analyze_archive</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Updates indexes of datasets and system tables stored in an enterprise geodatabase. Rebuilds existing attribute or spatial</span>
<span class="sd">    indexes. Updates database statistics of base tables, delta tables, and archive tables, along with the statistics on those tables</span>
<span class="sd">    indexes.**</span>

<span class="sd">    ===================   ========  =======================================================================================  ==========</span>
<span class="sd">    Parameter               Type                                      Description                                             Required</span>
<span class="sd">    ===================   ========  =======================================================================================  ==========</span>
<span class="sd">    **Workspace**         String    Path to sde connection file                                                              Yes</span>
<span class="sd">    **excludeList**       List      List of object names to exclude from being processed.                                    No</span>
<span class="sd">    **include_system**    Boolean   Indicates whether statistics will be gathered on the states and state lineages tables.   No\n</span>
<span class="sd">                                    * True = SYSTEM\n</span>
<span class="sd">                                    * False = NO_SYSTEM **(Default)**\n</span>
<span class="sd">    **delta_only**        Boolean   Indicates how the indexes will be rebuilt on the selected datasets.                      No\n</span>
<span class="sd">                                    * True = ONLY_DELTAS **(Default)**\n</span>
<span class="sd">                                    * False = ALL\n</span>
<span class="sd">    **only_versioned**    Boolean   Indicates if indexes will only be rebuilt for objects that are versioned.                No\n</span>
<span class="sd">                                    * True = Include only versioned objects. **(Default)**\n</span>
<span class="sd">                                    * False = Include all database objects versioned and non-versioned.\n</span>
<span class="sd">    **analyze_base**      Boolean   Indicates whether the selected dataset base tables will be analyzed.                     No\n</span>
<span class="sd">                                    * True = ANALYZE_BASE **(Default)**\n</span>
<span class="sd">                                    * False = NO_ANALYZE_BASE\n</span>
<span class="sd">    **analyze_delta**     Boolean   Indicates whether the selected dataset delta tables will be analyzed.                    No\n</span>
<span class="sd">                                    * True = ANALYZE_DELTA **(Default)**\n</span>
<span class="sd">                                    * False = NO_ANALYZE_DELTA\n</span>
<span class="sd">    **analyze_archive**   Boolean   Indicates whether the selected dataset delta tables will be analyzed.                    No\n</span>
<span class="sd">                                    * True = ANALYZE_ARCHIVE **(Default)**\n</span>
<span class="sd">                                    * False = NO_ANALYZE_ARCHIVE\n</span>
<span class="sd">    ===================   ========  =======================================================================================  ==========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Rebuild Indexes Analyze&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Rebuild Indexes Analyze&quot;</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span>
            <span class="n">userName</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span><span class="o">.</span><span class="n">connectionProperties</span><span class="o">.</span><span class="n">user</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">excludeList</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">excludeList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">excludeList</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">xList</span> <span class="o">=</span> <span class="n">excludeList</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Invalid parameter found for excludeList !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: List.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide a list of objects in the geodatabse&quot;</span>
               <span class="s">&quot; that you do not wish to have included in this process.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">include_system</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">include_system</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">include_system</span> <span class="o">=</span> <span class="s">&quot;NO_SYSTEM&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">include_system</span> <span class="o">=</span> <span class="s">&quot;SYSTEM&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter include_system !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">include_system</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">delta_only</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delta_only</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">delta_only</span> <span class="o">=</span> <span class="s">&quot;ALL&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_only</span> <span class="o">=</span> <span class="s">&quot;ONLY_DELTAS&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter delta_only !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_only</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">only_versioned</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter only_versioned !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_only</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">analyze_base</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">analyze_base</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">analyze_base</span> <span class="o">=</span> <span class="s">&quot;NO_ANALYZE_BASE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyze_base</span> <span class="o">=</span> <span class="s">&quot;ANALYZE_BASE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter analyze_base !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_only</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">analyze_delta</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">analyze_delta</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">analyze_delta</span> <span class="o">=</span> <span class="s">&quot;NO_ANALYZE_DELTA&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyze_delta</span> <span class="o">=</span> <span class="s">&quot;ANALYZE_DELTA&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter analyze_delta !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_only</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">analyze_archive</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">analyze_archive</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">analyze_archive</span> <span class="o">=</span> <span class="s">&quot;NO_ANALYZE_ARCHIVE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyze_archive</span> <span class="o">=</span> <span class="s">&quot;ANALYZE_ARCHIVE&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter analyze_archive !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_only</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Gathering list of database objects...&quot;</span><span class="p">)</span>

        <span class="n">fcs</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListFeatureClasses</span><span class="p">(</span><span class="s">&quot;*.{0}.*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>

        <span class="n">fds</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListDatasets</span><span class="p">(</span><span class="s">&#39;*.&#39;</span> <span class="o">+</span> <span class="n">userName</span> <span class="o">+</span> <span class="s">&#39;.*&#39;</span><span class="p">,</span><span class="s">&#39;Feature&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">fds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fd</span> <span class="ow">in</span> <span class="n">fds</span><span class="p">:</span>
                <span class="n">fcs</span> <span class="o">+=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListFeatureClasses</span><span class="p">(</span>
                <span class="s">&quot;*.{0}.*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">),</span><span class="n">feature_dataset</span><span class="o">=</span><span class="n">fd</span><span class="p">)</span>

                <span class="n">tbls</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListTables</span><span class="p">(</span><span class="s">&quot;*.{0}.*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>

                <span class="n">gdb_objects</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">fcs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">gdb_objects</span> <span class="o">+=</span> <span class="n">fcs</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">tbls</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">gdb_objects</span> <span class="o">+=</span> <span class="n">tbls</span>

                <span class="k">if</span> <span class="n">only_versioned</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">gdb_objects</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">isVersioned</span><span class="p">:</span>
                            <span class="n">gdb_objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">excludeList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">gdb_objects</span> <span class="o">=</span><span class="p">[</span><span class="n">objects</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">objects</span>
                                  <span class="ow">in</span> <span class="n">gdb_objects</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">exclude</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                                  <span class="k">for</span> <span class="n">exclude</span> <span class="ow">in</span> <span class="n">excludeList</span> <span class="k">if</span> <span class="n">exclude</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                                  <span class="ow">in</span> <span class="n">objects</span><span class="o">.</span><span class="n">upper</span><span class="p">())]</span>

                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">gdb_objects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">TestSchemaLock</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot; {0} will not be processed, cannot&quot;</span>
                              <span class="s">&quot; get exclusive schema&quot;</span>
                              <span class="s">&quot; lock.</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
                        <span class="n">gdb_objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">success</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; Error: rebuild index analyze&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span>
              <span class="s">&quot; An error occurred while trying to gather objects&quot;</span>
              <span class="s">&quot; for {0}.</span><span class="se">\n</span><span class="s"> Please ensure the correct connection file&quot;</span>
              <span class="s">&quot; is being referenced and that the user has permissions&quot;</span>
              <span class="s">&quot; to create versions.</span><span class="se">\n</span><span class="s"> Does the parent version being&quot;</span>
              <span class="s">&quot; referenced exist?</span><span class="se">\n</span><span class="s"> Is the correct string being passed&quot;</span>
              <span class="s">&quot; for PublicAccess?</span><span class="se">\n</span><span class="s"> Please review the log file for more&quot;</span>
              <span class="s">&quot; detailed information.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>

        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdb_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Beginning Rebuilding Indexes for FeatureClasses and&quot;</span>
             <span class="s">&quot; Tables for user: {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arcpy</span><span class="o">.</span><span class="n">RebuildIndexes_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                            <span class="n">include_system</span><span class="p">,</span>
                                            <span class="n">gdb_objects</span><span class="p">,</span>
                                            <span class="n">delta_only</span><span class="p">)</span>
            <span class="n">success</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">fds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">prnt</span><span class="p">(</span> <span class="s">&quot;Begin Analyzing FeatureDataSets for user:&quot;</span>
                      <span class="s">&quot; {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">AnalyzeDatasets_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                                 <span class="n">include_system</span><span class="p">,</span>
                                                 <span class="n">fds</span><span class="p">,</span>
                                                 <span class="n">analyze_base</span><span class="p">,</span>
                                                 <span class="n">analyze_delta</span><span class="p">,</span>
                                                 <span class="n">analyze_archive</span><span class="p">)</span>

                <span class="n">success</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">failed</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&quot;000684&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;  User does not have permissions to work with&quot;</span>
                      <span class="s">&quot; system tables</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;  TRYING WITHOUT SYSTEM TABLES!!! Beginning&quot;</span>
                         <span class="s">&quot; Rebuilding Indexes for FeatureClasses and&quot;</span>
                         <span class="s">&quot; Tables for user: {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>
                    <span class="n">arcpy</span><span class="o">.</span><span class="n">RebuildIndexes_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                                    <span class="s">&quot;NO_SYSTEM&quot;</span><span class="p">,</span>
                                                    <span class="n">gdb_objects</span><span class="p">,</span>
                                                    <span class="s">&quot;ALL&quot;</span><span class="p">)</span>

                    <span class="n">success</span><span class="p">()</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">fds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">prnt</span><span class="p">(</span> <span class="s">&quot;  TRYING WITHOUT SYSTEM TABLES!!! Begin&quot;</span>
                              <span class="s">&quot; Analyzing FeatureDataSets for user:&quot;</span>
                              <span class="s">&quot; {0} ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>
                        <span class="n">arcpy</span><span class="o">.</span><span class="n">AnalyzeDatasets_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                                         <span class="s">&quot;NO_SYSTEM&quot;</span><span class="p">,</span>
                                                         <span class="n">fds</span><span class="p">,</span>
                                                         <span class="n">analyze_base</span><span class="p">,</span>
                                                         <span class="n">analyze_delta</span><span class="p">,</span>
                                                         <span class="n">analyze_archive</span><span class="p">)</span>

                        <span class="n">success</span><span class="p">()</span>
                        <span class="k">return</span> <span class="bp">True</span>

                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">failed</span><span class="p">()</span>
                    <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: rebuild_indexes_analyze&quot;</span>
                    <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Rebuild Index and Analyze without system&quot;</span>
                           <span class="s">&quot; table failed for: {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; No FeatueClasses or Tables were found&quot;</span>
              <span class="s">&quot; for user: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">userName</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="reconcilepost"><a class="viewcode-back" href="../reconcilepost.html#RPLib.reconcilepost">[docs]</a><span class="k">def</span> <span class="nf">reconcilepost</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">log_folder</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">versions</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">parent_version</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                  <span class="n">delete_version</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="n">all_versions</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="n">acquire_locks</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="n">abort_if_conflicts</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="n">by_object</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="n">favor_target</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="n">post</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Reconciles a version or multiple versions against a target version.**</span>

<span class="sd">    ======================  ========  ===============================================================================================================================================================================================================================================  ==========</span>
<span class="sd">    Parameter                 Type                                      Description                                                                                                                                                                                                     Required</span>
<span class="sd">    ======================  ========  ===============================================================================================================================================================================================================================================  ==========</span>
<span class="sd">    **Workspace**           String    Path to sde connection file.                                                                                                                                                                                                                     Yes</span>
<span class="sd">    **log_folder**          String    Path to folder where log file(s) will be stored.                                                                                                                                                                                                 Yes</span>
<span class="sd">    **versions**            List      List of version names to be reconciled and posted.                                                                                                                                                                                               No\n</span>
<span class="sd">    **parent_version**      String    The geodatabase, or version of a geodatabase, which owns the version(s).                                                                                                                                                                         No\n</span>
<span class="sd">                                      * None  = &quot;sde.default&quot; **(Default)**\n</span>
<span class="sd">                                      * &quot;&quot;    = &quot;sde.default&quot;\n</span>
<span class="sd">    **delete_version**      Boolean   Indicates if versions will be deleted after posting to target version.                                                                                                                                                                           No\n</span>
<span class="sd">                                      * True  = Delete version after posting to target version. **(Default)**\n</span>
<span class="sd">                                      * False = Keep version after posting to target version.\n</span>
<span class="sd">    **all_versions**        Boolean   Determines which versions will be reconciled when the tool is executed.                                                                                                                                                                          No\n</span>
<span class="sd">                                      * True  = Reconciles edit versions with the target version. **(Default)**\n</span>
<span class="sd">                                      * False = Reconciles versions that are blocking the target version from compressing.\n</span>
<span class="sd">    **acquire_locks**       Boolean   Determines whether feature locks will be acquired.                                                                                                                                                                                               No\n</span>
<span class="sd">                                      * True  = Should be used when the intention is to post edits. **(Default)**\n</span>
<span class="sd">                                      * False = Should be used when the edit version will not be posted to the target version.</span>
<span class="sd">    **abort_if_conflicts**  Boolean   Reconcile will be aborted if conflicts are found between versions.                                                                                                                                                                               No\n</span>
<span class="sd">                                      * True  = Aborts the reconcile if conflicts are found. **(Default)**\n</span>
<span class="sd">                                      * False = Does not abort the reconcile if conflicts are found.</span>
<span class="sd">    **by_object**           Boolean   Describes the conditions required for a conflict to occur.                                                                                                                                                                                       No\n</span>
<span class="sd">                                      * True  = Any changes to the same row or feature in the parent and child versions will conflict during reconcile. **(Default)**\n</span>
<span class="sd">                                      * False = Only changes to the same attribute of the same row or feature in the parent and child versions will be flagged as a conflict during reconcile. Changes to different attributes will not be considered a conflict during reconcile.\n</span>
<span class="sd">    **favor_target**        Boolean   Describes the behavior if a conflict is detected.                                                                                                                                                                                                No\n</span>
<span class="sd">                                      * True  = Resolve in favor of the target version. **(Default)**\n</span>
<span class="sd">                                      * False = Resolve in favor of the edit version.\n</span>
<span class="sd">    **post**                Boolean   Posts the current edit session to the reconciled target version.                                                                                                                                                                                 No\n</span>
<span class="sd">                                      * True  = Version will be posted to the target version after the reconcile. **(Default)**\n</span>
<span class="sd">                                      * False = Version will not be posted to the target version after the reconcile.</span>
<span class="sd">    ======================  ========  ===============================================================================================================================================================================================================================================  ==========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Reconcile and Post&quot;</span><span class="p">,</span><span class="s">&quot;Workspace&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="s">&quot;Reconcile and Post&quot;</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">workspace</span> <span class="o">=</span> <span class="n">Workspace</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check reconcilepost log_folder</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">log_folder</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_folder</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">log_folder</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
        <span class="p">):</span>
        <span class="n">recPost_Log</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;None or empty string found&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">log_folder</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">log_folder</span><span class="p">):</span>
            <span class="n">recPost_Log</span> <span class="o">=</span> <span class="n">log_folder</span>
            <span class="c"># remove any trailing or leading spaces</span>
            <span class="n">recPost_Log</span> <span class="o">=</span> <span class="n">recPost_Log</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter log_folder !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The folder location {0} cannot be found.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: String.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide a valid path to a folder.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_folder</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># paramter check reconcilepost target_version</span>
    <span class="k">if</span> <span class="n">parent_version</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_version</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">target_version</span> <span class="o">=</span> <span class="s">&quot;sde.default&quot;</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">parent_version</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_version</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">target_version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent_version</span><span class="p">)</span>
        <span class="n">target_version</span> <span class="o">=</span> <span class="n">target_version</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter parent_version !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: String</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Received: {0}</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide the name of the&quot;</span>
               <span class="s">&quot; parent/target version as a string.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent_version</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># paramter check reconcilepost target_version</span>
    <span class="c"># check to ensure parent version exist.</span>
    <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">ListVersions</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">ver</span><span class="o">.</span><span class="n">isOwner</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">and</span> <span class="n">ver</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">target_version</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">target_version</span> <span class="o">=</span> <span class="n">parent_version</span>
            <span class="c">#print(&quot;found target version&quot;)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_version</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter parent_version !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The parent_version specified does not exist or could not&quot;</span>
               <span class="s">&quot; be found: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent_version</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="c"># parameter check reconcilepost edit_versions</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">versions</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">versions</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">):</span>
        <span class="n">edit_versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">ver</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ver</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">ListVersions</span><span class="p">()</span>
                         <span class="k">if</span> <span class="n">ver</span><span class="o">.</span><span class="n">isOwner</span> <span class="o">==</span> <span class="bp">True</span>
                         <span class="ow">and</span> <span class="n">ver</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">target_version</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="c">#print(&quot;Edit versions are: {0}&quot;.format(edit_versions))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edit_versions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Reconcile process was not performed !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&quot; The specified target version ({0}) has no edit versions&quot;</span>
                   <span class="s">&quot; to reconcile with.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target_version</span><span class="p">))</span>

            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">edit_versions</span> <span class="o">=</span> <span class="n">versions</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter versions !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: List</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Received: {0}</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide a valid list of&quot;</span>
               <span class="s">&quot; version names.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">versions</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost delete_version</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">delete_version</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">delete_version</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">with_delete</span> <span class="o">=</span> <span class="s">&quot;KEEP_VERSION&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">with_delete</span> <span class="o">=</span> <span class="s">&quot;DELETE_VERSION&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter delete_version !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delete_version</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost all_versions</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">all_versions</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">all_versions</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">reconcile_mode</span> <span class="o">=</span> <span class="s">&quot;BLOCKING_VERSIONS&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reconcile_mode</span> <span class="o">=</span> <span class="s">&quot;ALL_VERSIONS&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter all_versions !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_versions</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost acquire_locks</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">acquire_locks</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">acquire_locks</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">acquire_locks</span> <span class="o">=</span> <span class="s">&quot;NO_LOCK_ACQUIRED&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">acquire_locks</span> <span class="o">=</span> <span class="s">&quot;LOCK_ACQUIRED&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter acquire_locks !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acquire_locks</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost abort_if_conflicts</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abort_if_conflicts</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">abort_if_conflicts</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">abort_if_conflicts</span> <span class="o">=</span> <span class="s">&quot;NO_ABORT&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">abort_if_conflicts</span> <span class="o">=</span> <span class="s">&quot;ABORT_CONFLICTS&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter&quot;</span>
               <span class="s">&quot; abort_if_conflicts !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: True or False .</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abort_if_conflicts</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost by_object</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">by_object</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">by_object</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">conflict_definition</span> <span class="o">=</span> <span class="s">&quot;BY_ATTRIBUTE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conflict_definition</span> <span class="o">=</span> <span class="s">&quot;BY_OBJECT&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter by_object !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">by_object</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost favor_target</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">favor_target</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">favor_target</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">conflict_resolution</span> <span class="o">=</span> <span class="s">&quot;FAVOR_EDIT_VERSION&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">conflict_resolution</span> <span class="o">=</span> <span class="s">&quot;FAVOR_TARGET_VERSION&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter favor_target !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">favor_target</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># parameter check reconcilepost post</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">post</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">with_post</span> <span class="o">=</span> <span class="s">&quot;NO_POST&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">with_post</span> <span class="o">=</span> <span class="s">&quot;POST&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: reconcile and post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter post !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">post</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">DATE</span> <span class="o">=</span> <span class="s">&#39;%Y_%m_</span><span class="si">%d</span><span class="s">&#39;</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="s">&#39;%H_%M%p&#39;</span>

    <span class="n">out_log</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;{0}/RecPostProcess&quot;</span>
               <span class="s">&quot;_{1}_{2}.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recPost_Log</span><span class="p">,</span>
                                     <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">DATE</span><span class="p">),</span>
                                     <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">TIME</span><span class="p">)))</span>

    <span class="c">#print(out_log)</span>

    <span class="c">#print(edit_versions)</span>

    <span class="c"># Reconcile, Abort if conflicts are found, keep all versions, write</span>
    <span class="c"># output to logfile</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Begin reconciling all versions&quot;</span>
          <span class="s">&quot; {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">TIME</span><span class="p">)))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Attempting to Reconcile and Post Versions...&quot;</span><span class="p">)</span>
        <span class="n">arcpy</span><span class="o">.</span><span class="n">ReconcileVersions_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                           <span class="n">reconcile_mode</span><span class="p">,</span>
                                           <span class="n">target_version</span><span class="p">,</span>
                                           <span class="n">edit_versions</span><span class="p">,</span>
                                           <span class="n">acquire_locks</span><span class="p">,</span>
                                           <span class="n">abort_if_conflicts</span><span class="p">,</span>
                                           <span class="n">conflict_definition</span><span class="p">,</span>
                                           <span class="n">conflict_resolution</span><span class="p">,</span>
                                           <span class="n">with_post</span><span class="p">,</span>
                                           <span class="s">&quot;KEEP_VERSION&quot;</span><span class="p">,</span>
                                           <span class="n">out_log</span><span class="p">)</span>
        <span class="c"># Process: Check if conflicts exist</span>
        <span class="n">conflicts</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">GetMessages</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># If this error arises, there were conflicts in one or more</span>
        <span class="c"># of the # versions.</span>
        <span class="k">if</span> <span class="s">&quot;000084&quot;</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
            <span class="c"># Process: Read Contents of out_log so it can be added to</span>
            <span class="c"># email.</span>
            <span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_log</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">TEXT</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">log_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">detailed_string</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> An error occurred while Reconciling,&quot;</span>
                               <span class="s">&quot; Posting all versions, The first&quot;</span>
                               <span class="s">&quot; Reconcile and Post operation found&quot;</span>
                               <span class="s">&quot; conflicts. Please review and fix the&quot;</span>
                               <span class="s">&quot; conflicts and try again.&quot;</span><span class="p">)</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Reconcile and Post Conflicts&quot;</span>
            <span class="c"># Append contents of out_log to email message</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; {0}</span><span class="se">\n</span><span class="s"> A conflict was found for: {1}</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&quot; {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span><span class="n">Workspace</span><span class="p">,</span><span class="n">detailed_string</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="n">failed</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">success</span><span class="p">()</span>
            <span class="c"># This assumes the reconcile and post process was</span>
            <span class="c"># successful.</span>
            <span class="c"># Reconcile, Abort if conflicts are found, delete all</span>
            <span class="c"># versions since no conflicts were found in previous</span>
            <span class="c"># reconcile, do not write to log file</span>
            <span class="k">if</span> <span class="n">delete_version</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Reconciling, Posting, and Deleting All&quot;</span>
                         <span class="s">&quot; Versions... &quot;</span><span class="p">)</span>
                    <span class="n">arcpy</span><span class="o">.</span><span class="n">ReconcileVersions_management</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span>
                                                       <span class="n">reconcile_mode</span><span class="p">,</span>
                                                       <span class="n">target_version</span><span class="p">,</span>
                                                       <span class="n">edit_versions</span><span class="p">,</span>
                                                       <span class="n">acquire_locks</span><span class="p">,</span>
                                                       <span class="n">abort_if_conflicts</span><span class="p">,</span>
                                                       <span class="n">conflict_definition</span><span class="p">,</span>
                                                       <span class="n">conflict_resolution</span><span class="p">,</span>
                                                       <span class="n">with_post</span><span class="p">,</span>
                                                       <span class="n">with_delete</span><span class="p">)</span>
                    <span class="n">success</span><span class="p">()</span>
                    <span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_log</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
                    <span class="n">TEXT</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">log_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">Subject</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Success: Reconcile, Post, and&quot;</span>
                               <span class="s">&quot; Delete Versions&quot;</span><span class="p">)</span>
                    <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;{0}</span><span class="se">\n</span><span class="s">&quot;</span>
                          <span class="s">&quot; Reconciling, Posting, and Deleting all&quot;</span>
                          <span class="s">&quot; versions was successful&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TEXT</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">failed</span><span class="p">()</span>
                    <span class="c"># Process: Read Contents of out_log so it can be</span>
                    <span class="c"># added to email.</span>
                    <span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_log</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
                    <span class="n">TEXT</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">log_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">detailed_string</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;</span><span class="se">\n</span><span class="s"> An error occurred while Reconciling, Posting,&quot;</span>
                    <span class="s">&quot; and Deleting all versions.</span><span class="se">\n</span><span class="s"> The first Reconcile&quot;</span>
                    <span class="s">&quot; and Post operation was successful.</span><span class="se">\n</span><span class="s"> Although&quot;</span>
                    <span class="s">&quot; while attempting to reconcile, post, and delete&quot;</span>
                    <span class="s">&quot; all versions an error was encountered.</span><span class="se">\n</span><span class="s"> Please&quot;</span>
                    <span class="s">&quot; ensure no connections were being made to the&quot;</span>
                    <span class="s">&quot; database during this time and that no versions&quot;</span>
                    <span class="s">&quot; were in use and try again.&quot;</span><span class="p">)</span>

                    <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; Error: Reconcile and Post&quot;</span>
                    <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;{0}</span><span class="se">\n</span><span class="s">&quot;</span>
                          <span class="s">&quot; An error occurred while Reconciling,&quot;</span>
                          <span class="s">&quot; Posting, and Deleting all versions&quot;</span>
                          <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span><span class="n">detailed_string</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot; The option to delete_versions was disabled.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>


    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="c"># Process: Read Contents of out_log so it can be added to email.</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_log</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">TEXT</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">log_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">log_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">detailed_string</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&quot;</span><span class="se">\n</span><span class="s"> The first Reconcile and Post was not successful.</span><span class="se">\n</span><span class="s"> Please&quot;</span>
        <span class="s">&quot; ensure you are using the proper connection file for the owner&quot;</span>
        <span class="s">&quot; of the versions.</span><span class="se">\n</span><span class="s"> Additionally ensure there were no active&quot;</span>
        <span class="s">&quot; connections or versions in use during the Reconcile and Post&quot;</span>
        <span class="s">&quot; process and try again.&quot;</span><span class="p">)</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; Error: Reconcile and Post&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;{0}</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot;An error occurred while Reconciling and Posting&quot;</span>
              <span class="s">&quot;All Versions.</span><span class="se">\n</span><span class="s"> {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TEXT</span><span class="p">,</span><span class="n">detailed_string</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="truncateappend"><a class="viewcode-back" href="../truncateappend.html#RPLib.truncateappend">[docs]</a><span class="k">def</span> <span class="nf">truncateappend</span><span class="p">(</span><span class="n">SourceObject</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">DestinationObject</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">SourceObjectCount</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">ObjectsSchemaTest</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                   <span class="n">DestUpdateField</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">FieldMappings</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                   <span class="n">Subtype</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Truncates and appends data from one object to another.**</span>

<span class="sd">    ======================  =============   ====================================================================================================  ==========</span>
<span class="sd">    Parameter                 Type                                      Description                                                                Required</span>
<span class="sd">    ======================  =============   ====================================================================================================  ==========</span>
<span class="sd">    **SourceObject**        String          Path to the source geodatabase object.                                                                 Yes</span>
<span class="sd">    **DestinationObject**   String          Path to the destination/target geodatabase object.                                                     Yes</span>
<span class="sd">    **SourceObjectCount**   Integer         Number of records that must be in the SourceObject before beginning the process.                       No\n</span>
<span class="sd">                                            * None = 0 **(Default)**</span>
<span class="sd">    **ObjectsSchemaTest**   Boolean         The schema/fields of the input data must match the schema/fields of the target data.                   No\n</span>
<span class="sd">                                            * True = Input schema must match the schema of the target.\n</span>
<span class="sd">                                            * False = Input schema do not have to match that of the target dataset. **(Default)**</span>
<span class="sd">    **DestUpdateField**     String          Provide the name of a field in the DestinationObject.                                                  No\n</span>
<span class="sd">                                            * The field must be of type Date.\n</span>
<span class="sd">                                            * After data is appended this field will be calculated with the current date and time.</span>
<span class="sd">    **FieldMappings**       Field Mapping   Can only be used if ObjectsSchemaTest is False.                                                        No</span>
<span class="sd">    **Subtype**             String          A subtype description to assign that subtype to all new data that is appended to the target dataset.   No</span>
<span class="sd">    ======================  =============   ====================================================================================================  ==========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Begin Truncate Append.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking if Source exist...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verifyobject</span><span class="p">(</span><span class="n">SourceObject</span><span class="p">,</span><span class="s">&quot;Truncate Append&quot;</span><span class="p">,</span><span class="s">&quot;SourceObject&quot;</span><span class="p">):</span>
        <span class="n">Source</span> <span class="o">=</span> <span class="n">SourceObject</span>
        <span class="n">success</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking if Destination exist...&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verifyobject</span><span class="p">(</span><span class="n">DestinationObject</span><span class="p">,</span><span class="s">&quot;Truncate Append&quot;</span><span class="p">,</span><span class="s">&quot;DestinationObject&quot;</span><span class="p">):</span>
        <span class="n">Destination</span> <span class="o">=</span> <span class="n">DestinationObject</span>
        <span class="n">success</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check truncate and append SourceObjectCount</span>
    <span class="k">if</span> <span class="n">SourceObjectCount</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">SourceCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">SourceObjectCount</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="n">SourceCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">SourceObjectCount</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">SourceObjectCount</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">SourceCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SourceObjectCount</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">SourceObjectCount</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">SourceCount</span> <span class="o">=</span> <span class="n">SourceObjectCount</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: truncate and append&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter SourceObjectCount !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The parameter can be:</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39;  None, &quot;&quot;, an integer, or an integer within double quotes.</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Please provide a user defined value like below.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39;  None or &quot;&quot; or 1 or &quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking count for Source...&quot;</span><span class="p">)</span>
    <span class="n">getCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">arcpy</span><span class="o">.</span><span class="n">GetCount_management</span><span class="p">(</span><span class="n">Source</span><span class="p">)</span><span class="o">.</span><span class="n">getOutput</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;{0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getCount</span><span class="p">))</span>
    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking if {0} &gt;= {1}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getCount</span><span class="p">,</span> <span class="n">SourceCount</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">getCount</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">SourceCount</span><span class="p">):</span>
        <span class="n">success</span><span class="p">()</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking if destination workspace is SDE or Local GDB...&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: truncate and append&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Source object did not meet the requirement specified.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The Source object did not have enough rows to continue.&quot;</span>
              <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="s">&quot;.sde&quot;</span> <span class="ow">in</span> <span class="n">Destination</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Local</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking for exclusive schema lock on destination...&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">TestSchemaLock</span><span class="p">(</span><span class="n">Destination</span><span class="p">):</span>
            <span class="n">success</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">failed</span><span class="p">()</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Truncate Append&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;  Could not acquire a schema lock for: {0},&quot;</span>
                   <span class="s">&quot; might be in use.</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Destination</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;SDE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking that workspace is not versioned...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">Destination</span><span class="p">)</span><span class="o">.</span><span class="n">isVersioned</span><span class="p">:</span>
            <span class="n">success</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failed</span><span class="p">()</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Truncate Append&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="s">&quot; Data cannot be versioned {0}.</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Destination</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check truncate and append ObjectsSchemaTest</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ObjectsSchemaTest</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ObjectsSchemaTest</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">SchemaTest</span> <span class="o">=</span> <span class="s">&quot;NO_TEST&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SchemaTest</span> <span class="o">=</span> <span class="s">&quot;TEST&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: truncate and append&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter ObjectsSchemaTest !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True or False .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ObjectsSchemaTest</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check truncate and append DestUpdateField</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Checking if DestUpdateField is of type Date...&quot;</span><span class="p">)</span>
        <span class="n">destfields</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">ListFields</span><span class="p">(</span><span class="n">Destination</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">destfields</span><span class="p">:</span>
            <span class="n">fieldname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fieldname</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">):</span>
                <span class="n">DestUpdateField</span> <span class="o">=</span> <span class="n">fieldname</span>
                <span class="n">FieldType</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">type</span>
                <span class="k">if</span> <span class="n">FieldType</span> <span class="o">==</span> <span class="s">&quot;Date&quot;</span><span class="p">:</span>
                    <span class="n">success</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">failed</span><span class="p">()</span>
                    <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: truncate and append&quot;</span>
                    <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid parameter supplied for DestUpdateField !</span><span class="se">\n</span><span class="s">&quot;</span>
                           <span class="s">&quot; Expected: (string) Field Name, of type (Date) .</span><span class="se">\n</span><span class="s">&quot;</span>
                           <span class="s">&quot; Received: {0} type: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">,</span>
                                                             <span class="n">FieldType</span><span class="p">))</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: truncate and append&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter DestUpdateField !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: (string) Field Name .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Truncating Destination table...&quot;</span><span class="p">)</span>
        <span class="n">arcpy</span><span class="o">.</span><span class="n">TruncateTable_management</span><span class="p">(</span><span class="n">Destination</span><span class="p">)</span>
        <span class="n">success</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Truncate Append&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error occurred while Truncating:&quot;</span>
               <span class="s">&quot; {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Destination</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Appending Source to Destination...&quot;</span><span class="p">)</span>
        <span class="n">arcpy</span><span class="o">.</span><span class="n">Append_management</span><span class="p">(</span><span class="n">Source</span><span class="p">,</span>
                                <span class="n">Destination</span><span class="p">,</span>
                                <span class="n">SchemaTest</span><span class="p">,</span>
                                <span class="n">FieldMappings</span><span class="p">,</span>
                                <span class="n">Subtype</span><span class="p">)</span>
        <span class="n">success</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Truncate Append&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error occurred while Appending data to:&quot;</span>
               <span class="s">&quot; {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Destination</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">prnt</span><span class="p">(</span><span class="s">&quot; Calculating {0} with current date...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DestUpdateField</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arcpy</span><span class="o">.</span><span class="n">CalculateField_management</span><span class="p">(</span><span class="n">Destination</span><span class="p">,</span>
                                <span class="n">DestUpdateField</span><span class="p">,</span>
                                <span class="s">&quot;calcDay(  !IMPDATE! )&quot;</span><span class="p">,</span>
                                <span class="s">&quot;PYTHON_9.3&quot;</span><span class="p">,</span>
                                <span class="s">&quot;def calcDay(dateField):</span><span class="se">\\</span><span class="s">n   &quot;</span>
                                <span class="s">&quot;dateValue = datetime.datetime.now()</span><span class="se">\\</span><span class="s">n   &quot;</span>
                                <span class="s">&quot;return dateValue&quot;</span><span class="p">)</span>
            <span class="n">success</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;End Truncate Append.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">failed</span><span class="p">()</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Truncate Append&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error occurred while calculating&quot;</span>
                   <span class="s">&quot; {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">UpdateField</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;No</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="syncreplicas"><a class="viewcode-back" href="../syncreplicas.html#RPLib.syncreplicas">[docs]</a><span class="k">def</span> <span class="nf">syncreplicas</span><span class="p">(</span><span class="n">ParentGDB</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">ChildGDB</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">ReplicaName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">GDB1_TO_2</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                 <span class="n">FAVOR_GDB1</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                 <span class="n">BY_OBJECT</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                 <span class="n">DO_NOT_RECONCILE</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Synchronizes updates between two replica geodatabases in a direction specified by the user.**</span>

<span class="sd">    ======================  =============   ==========================================================================================================  ==========</span>
<span class="sd">    Parameter                 Type                                      Description                                                                      Required</span>
<span class="sd">    ======================  =============   ==========================================================================================================  ==========</span>
<span class="sd">    **ParentGDB**           String          The geodatabase hosting the replica to synchronize, may be local or remote.                                 Yes</span>
<span class="sd">    **ChildGDB**            String          The geodatabase hosting the relative replica, geodatabase may be local or remote.                           Yes</span>
<span class="sd">    **ReplicaName**         String                                                                                                                      Yes\n</span>
<span class="sd">                                            A valid replica with a parent contained within one input geodatabase and a child in the other</span>
<span class="sd">                                            input geodatabase.</span>
<span class="sd">    **GDB1_TO_2**           Boolean                                                                                                                     No\n</span>
<span class="sd">                                            The direction in which you want changes to be sent from geodatabase 1 to geodatabase 2, from</span>
<span class="sd">                                            geodatabase 2 to geodatabase 1, or to send changes in both directions. For check-out/check-in</span>
<span class="sd">                                            replicas or one-way replicas there is only one appropriate direction. If the replica is two-way</span>
<span class="sd">                                            then any of the three choices are available.\n</span>
<span class="sd">                                            * True     = FROM_GEODATABASE1_TO_2 -Parent to Child. **(Default)**\n</span>
<span class="sd">                                            * False    = FROM_GEODATABASE2_TO_1 -Child to Parent.\n</span>
<span class="sd">                                            * &quot;BOTH&quot;   = BOTH_DIRECTIONS **(overrides Boolean)**\n</span>
<span class="sd">    **FAVOR_GDB1**          Boolean         Specifies how conflicts are resolved when they are encountered.                                             No\n</span>
<span class="sd">                                            * True     = IN_FAVOR_OF_GDB1 -Conflicts resolve in favor of the PARENTGDB. **(Default)**\n</span>
<span class="sd">                                            * False    = IN_FAVOR_OF_GDB2 -Conflicts resolve in favor of the CHILDGDB.\n</span>
<span class="sd">                                            * &quot;MANUAL&quot; = MANUAL, Manually resolve conflicts in the versioning environment. **(overrides Boolean)**\n</span>
<span class="sd">    **BY_OBJECT**           Boolean         Specifies how you would like to define conflicts.                                                           No\n</span>
<span class="sd">                                            * True     = BY_OBJECT -Detects conflicts by row. **(Default)**\n</span>
<span class="sd">                                            * False    = BY_ATTRIBUTE -Detects conflicts by column.\n</span>
<span class="sd">    **DO_NOT_RECONCILE**    Boolean                                                                                                                     No\n</span>
<span class="sd">                                            Indicates whether to automatically reconcile once data changes are sent to the parent replica if</span>
<span class="sd">                                            there are no conflicts present. This option is only available for check-out/check-in.\n</span>
<span class="sd">                                            * True     = DO_NOT_RECONCILE -Do not reconcile. **(Default)**\n</span>
<span class="sd">                                            * False    = RECONCILE -Reconcile\n</span>
<span class="sd">    ======================  =============   ==========================================================================================================  ==========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">ParentGDB</span><span class="p">,</span><span class="s">&quot;Sync Replicas&quot;</span><span class="p">,</span><span class="s">&quot;ParentGDB&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verifysde</span><span class="p">(</span><span class="n">ParentGDB</span><span class="p">,</span><span class="s">&quot;Sync Replicas&quot;</span><span class="p">):</span>
            <span class="n">Parent</span> <span class="o">=</span> <span class="n">ParentGDB</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verifyworkspace</span><span class="p">(</span><span class="n">ChildGDB</span><span class="p">,</span><span class="s">&quot;Sync Replicas&quot;</span><span class="p">,</span><span class="s">&quot;ChildGDB&quot;</span><span class="p">):</span>
        <span class="n">Child</span> <span class="o">=</span> <span class="n">ChildGDB</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica ReplicaName</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ReplicaName</span> <span class="o">==</span> <span class="bp">None</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReplicaName</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">ReplicaName</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
            <span class="p">):</span>
        <span class="n">repname</span> <span class="o">=</span> <span class="n">ReplicaName</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replicas&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter ReplicaName !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The parameter cannot be None or empty.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: String.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide the name for a Replica within the geodatabase.&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica ReplicaName in ParentGDB</span>
    <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">ListReplicas</span><span class="p">(</span><span class="n">ParentGDB</span><span class="p">):</span>
        <span class="n">repname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">replica</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">ReplicaName</span><span class="p">)</span> <span class="ow">in</span> <span class="n">repname</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="c">#print(&quot;Found a match&quot;)</span>
            <span class="n">RepName</span> <span class="o">=</span> <span class="n">repname</span>
            <span class="c">#print(RepName)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter ReplicaName !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&quot; The replica name was not found in the ParentGDB.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica ReplicaName in ChildGDB</span>
    <span class="k">for</span> <span class="n">replica</span> <span class="ow">in</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">da</span><span class="o">.</span><span class="n">ListReplicas</span><span class="p">(</span><span class="n">ChildGDB</span><span class="p">):</span>
        <span class="n">repname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">replica</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">ReplicaName</span><span class="p">)</span> <span class="ow">in</span> <span class="n">repname</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="c">#print(&quot;Found a match&quot;)</span>
            <span class="c">#print(RepName)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter ReplicaName !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&quot; The replica name was not found in the ChildGDB.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica GDB1_TO_2</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">GDB1_TO_2</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">GDB1_TO_2</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">in_direction</span> <span class="o">=</span> <span class="s">&quot;FROM_GEODATABASE1_TO_2&quot;</span>
        <span class="k">elif</span> <span class="n">GDB1_TO_2</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">in_direction</span> <span class="o">=</span> <span class="s">&quot;FROM_GEODATABASE2_TO_1&quot;</span>
        <span class="k">elif</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">GDB1_TO_2</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;BOTH&quot;</span><span class="p">:</span>
            <span class="n">in_direction</span> <span class="o">=</span> <span class="s">&quot;BOTH&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter GDB1_TO_2 !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&#39; Expected: True, False, or &quot;BOTH&quot; .</span><span class="se">\n</span><span class="s">&#39;</span>
                   <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GDB1_TO_2</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter GDB1_TO_2 !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39; Expected: True, False, or &quot;BOTH&quot; .</span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&quot; Received: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GDB1_TO_2</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica FAVOR_GDB1</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">FAVOR_GDB1</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">FAVOR_GDB1</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">conflict_policy</span> <span class="o">=</span> <span class="s">&quot;IN_FAVOR_OF_GDB1&quot;</span>
        <span class="k">elif</span> <span class="n">FAVOR_GDB1</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">conflict_policy</span> <span class="o">=</span> <span class="s">&quot;IN_FAVOR_OF_GDB2&quot;</span>
        <span class="k">elif</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">FAVOR_GDB1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;MANUAL&quot;</span><span class="p">:</span>
            <span class="n">conflict_policy</span> <span class="o">=</span> <span class="s">&quot;MANUAL&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter FAVOR_GDB1 !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&#39;Expected: True or False or &quot;MANUAL&quot; </span><span class="se">\n</span><span class="s">&#39;</span>
                   <span class="s">&#39;Received: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FAVOR_GDB1</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter FAVOR_GDB1 !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39;Expected: True or False or &quot;MANUAL&quot; </span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&#39;Received: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FAVOR_GDB1</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica BY_OBJECT</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">BY_OBJECT</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">BY_OBJECT</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">conflict_definition</span> <span class="o">=</span> <span class="s">&quot;BY_OBJECT&quot;</span>
        <span class="k">elif</span> <span class="n">BY_OBJECT</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">conflict_definition</span> <span class="o">=</span> <span class="s">&quot;BY_ATTRIBUTE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter BY_OBJECT !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&#39;Expected: True or False </span><span class="se">\n</span><span class="s">&#39;</span>
                   <span class="s">&#39;Received: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">BY_OBJECT</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter BY_OBJECT !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&#39;Expected: True or False </span><span class="se">\n</span><span class="s">&#39;</span>
               <span class="s">&#39;Received: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">BY_OBJECT</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c"># parameter check syncreplica DO_NOT_RECONCILE</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">DO_NOT_RECONCILE</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">DO_NOT_RECONCILE</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">reconcile</span> <span class="o">=</span> <span class="s">&quot;DO_NOT_RECONCILE&quot;</span>
        <span class="k">elif</span> <span class="n">DO_NOT_RECONCILE</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">reconcile</span> <span class="o">=</span> <span class="s">&quot;RECONCILE&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for &quot;</span>
                   <span class="s">&quot;parameter DO_NOT_RECONCILE !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&#39;Expected: True or False </span><span class="se">\n</span><span class="s">&#39;</span>
                   <span class="s">&#39;Received: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DO_NOT_RECONCILE</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for &quot;</span>
                   <span class="s">&quot;parameter DO_NOT_RECONCILE !</span><span class="se">\n</span><span class="s">&quot;</span>
                   <span class="s">&#39;Expected: True or False </span><span class="se">\n</span><span class="s">&#39;</span>
                   <span class="s">&#39;Received: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DO_NOT_RECONCILE</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Synchronizing replica {0}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RepName</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">arcpy</span><span class="o">.</span><span class="n">SynchronizeChanges_management</span><span class="p">(</span><span class="n">ParentGDB</span><span class="p">,</span>
                                            <span class="n">RepName</span><span class="p">,</span>
                                            <span class="n">ChildGDB</span><span class="p">,</span>
                                            <span class="n">in_direction</span><span class="p">,</span>
                                            <span class="n">conflict_policy</span><span class="p">,</span>
                                            <span class="n">conflict_definition</span><span class="p">,</span>
                                            <span class="n">reconcile</span><span class="p">)</span>

        <span class="n">success</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&quot;000622&quot;</span> <span class="ow">or</span> <span class="s">&quot;000800&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;  An error was encountered while trying to synchronize.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;  Consider setting DO_NOT_RECONCILE parameter to True.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;  Attempting to synchronize without reconciling...&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">arcpy</span><span class="o">.</span><span class="n">SynchronizeChanges_management</span><span class="p">(</span><span class="n">ParentGDB</span><span class="p">,</span>
                                                    <span class="n">RepName</span><span class="p">,</span>
                                                    <span class="n">ChildGDB</span><span class="p">,</span>
                                                    <span class="n">in_direction</span><span class="p">,</span>
                                                    <span class="n">conflict_policy</span><span class="p">,</span>
                                                    <span class="n">conflict_definition</span><span class="p">,</span>
                                                    <span class="s">&quot;DO_NOT_RECONCILE&quot;</span><span class="p">)</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">failed</span><span class="p">()</span>
                <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: Sync Replica&quot;</span>
                <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Trying to synchronize changes failed.</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;An attempt was made to synchronize with reconcile and &quot;</span>
                       <span class="s">&quot;failed.</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;An attempt was also made to synchronize without &quot;</span>
                       <span class="s">&quot; reconciling and also failed.</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;Please ensure all parameters are valid and try again.&quot;</span>
                      <span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>


</div>
<div class="viewcode-block" id="controlservices"><a class="viewcode-back" href="../controlservices.html#RPLib.controlservices">[docs]</a><span class="k">def</span> <span class="nf">controlservices</span><span class="p">(</span><span class="n">Folder</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">Operation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">ServerName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">UserName</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">Password</span><span class="o">=</span><span class="bp">None</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Manage individual ArcGIS Server services at the folder level or through</span>
<span class="sd">    the Windows Services Console by stopping or starting the main ArcGIS</span>
<span class="sd">    Server service.**</span>

<span class="sd">    ======================  =============   ============================================================================================================  ==========</span>
<span class="sd">    Parameter                 Type                                      Description                                                                        Required</span>
<span class="sd">    ======================  =============   ============================================================================================================  ==========</span>
<span class="sd">    **Folder**              String                                                                                                                        Yes\n</span>
<span class="sd">                                            The folder containing the services you wish to stop or start on your ArcGIS Server.\n</span>

<span class="sd">                                            * &quot;ALL&quot; = Will perform the Operation on the main ArcGIS Server service through the Windows Services Console.</span>

<span class="sd">                                            **Note &quot;ALL&quot; should only be used on machines running Windows Server.**\n</span>

<span class="sd">    **Operation**           String                                                                                                                        Yes\n</span>
<span class="sd">                                            Specify the operation you wish to perform on the service(s).\n</span>

<span class="sd">                                            * &quot;START&quot; = Will Start services.\n</span>

<span class="sd">                                            * &quot;STOP&quot; = Will Stop services.\n</span>

<span class="sd">    **ServerName**          String                                                                                                                        Yes\n</span>
<span class="sd">                                            The name or IP address of the server where ArcGIS Server is running.\n</span>
<span class="sd">    **UserName**            Boolean                                                                                                                       Yes\n</span>
<span class="sd">                                            Specify an administrative user for ArcGIS Server.\n</span>
<span class="sd">    **Password**            Boolean                                                                                                                       Yes\n</span>
<span class="sd">                                            Specify the administrative user password for ArcGIS Server.\n</span>
<span class="sd">    ======================  =============   ============================================================================================================  ==========</span>

<span class="sd">    **Returns: Boolean**</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Ask for admin/publisher user name and password</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">UserName</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">Password</span>

    <span class="c"># Ask for server name</span>
    <span class="n">serverName</span> <span class="o">=</span> <span class="n">ServerName</span>
    <span class="n">serverPort</span> <span class="o">=</span> <span class="mi">6080</span>

    <span class="n">folder</span> <span class="o">=</span> <span class="n">Folder</span>
    <span class="n">stopOrStart</span> <span class="o">=</span> <span class="n">Operation</span>

    <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;ALL&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">stopOrStart</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;STOP&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;sc </span><span class="se">\\\\</span><span class="s">{0} stop &quot;ArcGIS Server&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serverName</span><span class="p">))</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">failed</span><span class="p">()</span>
                <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: control services&quot;</span>
                <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error occurred while stopping ArcGIS Server&quot;</span>
                       <span class="s">&quot; for: {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serverName</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">stopOrStart</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;START&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;sc </span><span class="se">\\\\</span><span class="s">{0} start &quot;ArcGIS Server&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serverName</span><span class="p">))</span>
                <span class="n">success</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">failed</span><span class="p">()</span>
                <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: control services&quot;</span>
                <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error occurred while starting ArcGIS Server&quot;</span>
                      <span class="s">&quot; for: {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serverName</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Print some info</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This tool is a sample script that stops or starts&quot;</span>
                      <span class="s">&quot; all services in a folder.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

                <span class="c"># Check to make sure stop/start parameter is a valid value</span>
                <span class="k">if</span> <span class="p">[</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">stopOrStart</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;START&quot;</span>
                    <span class="ow">and</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">stopOrStart</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;STOP&quot;</span><span class="p">]:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot; Invalid STOP/START parameter entered</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">False</span>

                <span class="c"># Get a token</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">getToken</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">serverName</span><span class="p">,</span> <span class="n">serverPort</span><span class="p">)</span>
                <span class="c">#if token == &quot;&quot;:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="c"># Construct URL to read folder</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;ROOT&quot;</span><span class="p">:</span>
                        <span class="n">folder</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">folder</span> <span class="o">+=</span> <span class="s">&quot;/&quot;</span>

                    <span class="n">folderURL</span> <span class="o">=</span> <span class="s">&quot;/arcgis/admin/services/&quot;</span> <span class="o">+</span> <span class="n">folder</span>

                    <span class="c"># This request only needs the token and the response formatting parameter</span>
                    <span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span><span class="s">&#39;token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="s">&#39;json&#39;</span><span class="p">})</span>

                    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span> <span class="s">&quot;Accept&quot;</span><span class="p">:</span> <span class="s">&quot;text/plain&quot;</span><span class="p">}</span>

                    <span class="c"># Connect to URL and post parameters</span>
                    <span class="n">httpConn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">serverName</span><span class="p">,</span> <span class="n">serverPort</span><span class="p">)</span>
                    <span class="n">httpConn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">folderURL</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

                    <span class="c"># Read response</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">httpConn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">):</span>
                        <span class="n">httpConn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&quot; Could not read folder information.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="bp">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                        <span class="c"># Check that data returned is not an error object</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">assertJsonSuccess</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&quot; Error when reading folder&quot;</span>
                                  <span class="s">&quot; information. {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
                            <span class="k">return</span> <span class="bp">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&quot; Processed folder information successfully.&quot;</span>
                                  <span class="s">&quot; Now processing services...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

                        <span class="c"># Deserialize response into Python object</span>
                        <span class="n">dataObj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">httpConn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                        <span class="c"># Loop through each service in the folder and stop or</span>
                        <span class="c"># start it</span>
                        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataObj</span><span class="p">[</span><span class="s">&#39;services&#39;</span><span class="p">]:</span>

                            <span class="n">fullSvcName</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;serviceName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span>

                            <span class="c"># Construct URL to stop or start service, then make the request</span>
                            <span class="n">stopOrStartURL</span> <span class="o">=</span> <span class="s">&quot;/arcgis/admin/services/&quot;</span> <span class="o">+</span> <span class="n">folder</span> <span class="o">+</span> <span class="n">fullSvcName</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">stopOrStart</span>
                            <span class="n">httpConn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">stopOrStartURL</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

                            <span class="c"># Read stop or start response</span>
                            <span class="n">stopStartResponse</span> <span class="o">=</span> <span class="n">httpConn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">stopStartResponse</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">):</span>
                                <span class="n">httpConn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                                <span class="k">print</span><span class="p">(</span><span class="s">&quot; Error while executing stop or start.&quot;</span>
                                      <span class="s">&quot; Please check the URL and try again.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="bp">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">stopStartData</span> <span class="o">=</span> <span class="n">stopStartResponse</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                                <span class="c"># Check that data returned is not an error</span>
                                <span class="c"># object</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">assertJsonSuccess</span><span class="p">(</span><span class="n">stopStartData</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">stopOrStart</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;START&quot;</span><span class="p">:</span>
                                        <span class="k">print</span><span class="p">(</span><span class="s">&quot; Error returned when starting&quot;</span>
                                              <span class="s">&quot; service {0}.</span><span class="se">\n</span><span class="s">&quot;</span>
                                              <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullSvcName</span><span class="p">))</span>
                                        <span class="k">return</span> <span class="bp">False</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">print</span><span class="p">(</span><span class="s">&quot; Error returned when stopping&quot;</span>
                                              <span class="s">&quot; service {0}.</span><span class="se">\n</span><span class="s">&quot;</span>
                                              <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullSvcName</span><span class="p">))</span>
                                        <span class="k">return</span> <span class="bp">False</span>

                                    <span class="k">print</span><span class="p">(</span><span class="n">stopStartData</span><span class="p">)</span>

                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;  Service {0} processed&quot;</span>
                                          <span class="s">&quot; successfully.</span><span class="se">\n</span><span class="s">&quot;</span>
                                          <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fullSvcName</span><span class="p">))</span>
                                    <span class="k">return</span> <span class="bp">True</span>

                            <span class="n">httpConn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                        <span class="c"># Clean Up</span>
                        <span class="c">#</span>
                        <span class="k">del</span> <span class="n">username</span>
                        <span class="k">del</span> <span class="n">password</span>
                        <span class="k">del</span> <span class="n">serverName</span>
                        <span class="k">del</span> <span class="n">serverPort</span>
                        <span class="k">del</span> <span class="n">folder</span>
                        <span class="k">del</span> <span class="n">stopOrStart</span>

<span class="c"># A function to generate a token given username, password and the adminURL.</span></div>
<span class="k">def</span> <span class="nf">getToken</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">serverName</span><span class="p">,</span> <span class="n">serverPort</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for controlservices function. A token is needed to verify</span>
<span class="sd">    authentication to manage ArcGIS Server services. All parameters are either</span>
<span class="sd">    passed by the controlservices function and or are otherwise hardcoded. Note</span>
<span class="sd">    if you named your instance anything other than arcgis please see the</span>
<span class="sd">    tokenURL and change to the name of your instance.</span>

<span class="sd">    Returns: Boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Token URL is typically http://server[:port]/arcgis/admin/generateToken</span>
    <span class="n">tokenURL</span> <span class="o">=</span> <span class="s">&quot;/arcgis/admin/generateToken&quot;</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">({</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                               <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
                               <span class="s">&#39;client&#39;</span><span class="p">:</span> <span class="s">&#39;requestip&#39;</span><span class="p">,</span>
                               <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="s">&#39;json&#39;</span><span class="p">})</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span>
               <span class="s">&quot;Accept&quot;</span><span class="p">:</span> <span class="s">&quot;text/plain&quot;</span><span class="p">}</span>

    <span class="c"># Connect to URL and post parameters</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">httpConn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">serverName</span><span class="p">,</span> <span class="n">serverPort</span><span class="p">)</span>
        <span class="n">httpConn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">tokenURL</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">failed</span><span class="p">()</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: control services&quot;</span>
        <span class="n">ErrMsg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Could not generate a token with the username and password&quot;</span>
                  <span class="s">&quot; provided. </span><span class="se">\n</span><span class="s"> Also check that the server name/ip address&quot;</span>
                  <span class="s">&quot; provided is valid.&quot;</span><span class="p">)</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Error connecting to {0} on port 6080.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; {1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serverName</span><span class="p">,</span><span class="n">ErrMsg</span><span class="p">))</span>

        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c"># Read response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">httpConn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">):</span>
        <span class="n">httpConn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; Error while fetching tokens from admin URL.</span><span class="se">\n</span><span class="s">&quot;</span>
              <span class="s">&quot; Please check the URL and try again.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">httpConn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># Check that data returned is not an error object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">assertJsonSuccess</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c"># Extract the token from it</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">token</span><span class="p">[</span><span class="s">&#39;token&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">assertJsonSuccess</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A function that checks that the input JSON object is not an error object.</span>

<span class="sd">    Returns: Boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">obj</span> <span class="ow">and</span> <span class="n">obj</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;error&quot;</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Error: JSON object returns an error. &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="deletefilesolderthan"><a class="viewcode-back" href="../deletefilesolderthan.html#RPLib.deletefilesolderthan">[docs]</a><span class="k">def</span> <span class="nf">deletefilesolderthan</span><span class="p">(</span><span class="n">Number_Of_Days</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="n">FolderLocation</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Manages the cleanup of logfiles generated by RPLib.**</span>

<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    Parameter            Type      Description                                                                              Required</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>
<span class="sd">    **Number_Of_Days**   Integer   Files that are so many days older than the current day will be deleted.                  Yes</span>
<span class="sd">    **FolderLocation**   String    The folder where the logfiles are being stored.                                          Yes</span>
<span class="sd">    ==================   ========  =======================================================================================  =========</span>

<span class="sd">    **Returns: Boolean**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">FolderLocation</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">Number_Of_Days</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">days</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">days</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">prnt</span><span class="p">(</span><span class="s">&quot;Deleting files older than {0} days...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">days</span><span class="p">))</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">nf</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span> <span class="o">&lt;</span> <span class="n">now</span> <span class="o">-</span> <span class="n">days</span> <span class="o">*</span> <span class="mi">86400</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
            <span class="n">success</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">failed</span><span class="p">()</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: delete files older than&quot;</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; An error occurred while trying to delete files in&quot;</span>
                   <span class="s">&quot; {0}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;The path specified does not exist!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<span class="k">def</span> <span class="nf">verifysde</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="n">functionName</span><span class="p">,):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to verify that the workspace specified exist and that it is</span>
<span class="sd">    an SDE database. All parameters are passed from other functions.</span>

<span class="sd">    Returns: Boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Describe</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span>

    <span class="c"># Describe function property workspaceFactoryProgID for SDE databases.</span>
    <span class="n">sdewrkspc</span> <span class="o">=</span> <span class="s">&quot;esriDataSourcesGDB.SdeWorkspaceFactory.1&quot;</span>

    <span class="c"># Check if workspace is an SDE database.</span>
    <span class="k">if</span> <span class="n">desc</span><span class="o">.</span><span class="n">workspaceFactoryProgID</span> <span class="o">!=</span> <span class="n">sdewrkspc</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">)</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; ERROR: {0}</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; This tool only works with SDE databases.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please supply a valid path to an SDE database.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Received: {1}</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Type: {2}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">,</span>
                                     <span class="n">Workspace</span><span class="p">,</span>
                                     <span class="n">desc</span><span class="o">.</span><span class="n">workspaceFactoryProgID</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">verifyworkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="p">,</span><span class="n">functionName</span><span class="p">,</span><span class="n">ParameterName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to verify that the workspace specified exist. All parameters</span>
<span class="sd">    are passed from other functions.</span>

<span class="sd">    Returns: Boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Workspace</span> <span class="o">==</span> <span class="bp">None</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">Workspace</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">)</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; ERROR: {0}</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Invalid expression supplied for parameter {1} !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The parameter cannot be None or empty.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: String.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide a valid path to an enterprise&quot;</span>
               <span class="s">&quot; geodatabase&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">,</span><span class="n">ParameterName</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">Workspace</span><span class="p">):</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">)</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; Workspace {0} does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Workspace</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">verifyobject</span><span class="p">(</span><span class="n">Object</span><span class="p">,</span><span class="n">functionName</span><span class="p">,</span><span class="n">ParameterName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to verify that an object specified exists. All parameters</span>
<span class="sd">    are passed from other functions.</span>

<span class="sd">    Returns: Boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Object</span> <span class="o">==</span> <span class="bp">None</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Object</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">Object</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span>
            <span class="p">):</span>
        <span class="k">if</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">)</span>
            <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot; {0} {1} does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ParameterName</span><span class="p">,</span><span class="n">Object</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">Subject</span> <span class="o">=</span> <span class="s">&quot; ERROR: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">functionName</span><span class="p">)</span>
        <span class="n">Msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Invalid expression supplied for parameter: {0} !</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; The parameter cannot be None or empty.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Expected: String.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot; Please provide a valid path to a geodatabase&quot;</span>
               <span class="s">&quot; object like a featureclass or table.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Object</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">Msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">email_ON</span><span class="p">:</span> <span class="n">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span> <span class="n">Msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">success</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to show that an operation ran successfully. Also handles</span>
<span class="sd">    the type of message returned, if verbose logging is enabled the full arcpy</span>
<span class="sd">    messages are returned. If verbose logging is disabled a simple message of</span>
<span class="sd">    Success is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">GetMessages</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="k">if</span> <span class="n">verboseLog</span> <span class="k">else</span> <span class="s">&quot;Success</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">failed</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to show that an operation failed. Also handles</span>
<span class="sd">    the type of message returned, if verbose logging is enabled the full arcpy</span>
<span class="sd">    messages are returned. If verbose logging is disabled a simple message of</span>
<span class="sd">    Failed is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">GetMessages</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="k">if</span> <span class="n">verboseLog</span> <span class="k">else</span> <span class="s">&quot;Failed</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prnt</span><span class="p">(</span><span class="n">statement</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to show messages returned at the end of a line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">email</span><span class="p">(</span><span class="n">Subject</span><span class="p">,</span><span class="n">Msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to send detailed information about when a function succeeds</span>
<span class="sd">    or fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">email_Subject</span> <span class="o">=</span> <span class="n">Subject</span>
    <span class="n">email_Msg</span> <span class="o">=</span> <span class="n">Msg</span>

    <span class="c"># take the email list and use it to send an email to connected users.</span>
    <span class="n">COMMASPACE</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span>
    <span class="c"># Prepare actual message</span>
    <span class="n">BODY</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
            <span class="s">&quot;From: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">email_From</span><span class="p">,</span>
            <span class="s">&quot;To: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>  <span class="n">COMMASPACE</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">email_To</span><span class="p">),</span>
            <span class="s">&quot;Subject: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">email_Subject</span> <span class="p">,</span>
            <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">email_Msg</span>
            <span class="p">),</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

    <span class="c"># Send the mail</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">email_IP</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">email_Port</span><span class="p">))</span>
    <span class="c"># If Authentication is required specify in the 2 lines below</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">email_Username</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">email_Password</span>
    <span class="c"># Ping the server to do a handshake and authenticate</span>
    <span class="n">server</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Send the email and exit connection to smtp server</span>
                <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">email_From</span><span class="p">,</span> <span class="n">email_To</span><span class="p">,</span> <span class="n">BODY</span><span class="p">)</span>
                <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot; Authentication may be required to send emails from this&quot;</span>
                      <span class="s">&quot; SMTP server.</span><span class="se">\n</span><span class="s"> Please try supplying username and&quot;</span>
                      <span class="s">&quot; password.</span><span class="se">\n</span><span class="s"> If supplying username and password does&quot;</span>
                      <span class="s">&quot; not work contact your system administrator and verify&quot;</span>
                      <span class="s">&quot; the IP address and PORT numbers are correct.&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>
            <span class="c"># Send the email and exit connection to smtp server</span>
            <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">email_From</span><span class="p">,</span> <span class="n">email_To</span><span class="p">,</span> <span class="n">BODY</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot; Authentication may have failed for this SMTP server.</span><span class="se">\n</span><span class="s">&quot;</span>
                  <span class="s">&quot; Please verify the username and password.</span><span class="se">\n</span><span class="s"> If username&quot;</span>
                  <span class="s">&quot; and password are correct consider contacting your system&quot;</span>
                  <span class="s">&quot; administrator to verify the IP address and PORT numbers&quot;</span>
                  <span class="s">&quot; are correct.</span><span class="se">\n</span><span class="s"> Also ensure that authentication is required,&quot;</span>
                  <span class="s">&quot; try leaving username and password blank and try again.&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">catch_errors</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator function to support error handling.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Decorator function&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">f</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">tbInfo</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">tb</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;PYTHON ERRORS:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">tbInfo</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_value</span><span class="p">))</span>
            <span class="n">gp_errors</span> <span class="o">=</span> <span class="n">arcpy</span><span class="o">.</span><span class="n">GetMessages</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gp_errors</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;GP ERRORS:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">gp_errors</span><span class="p">)</span>
    <span class="c"># End decorator function</span>
    <span class="k">return</span> <span class="n">decorator</span>
<span class="c"># End catch_errors function</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">RPLib 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Ken Carrier.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>